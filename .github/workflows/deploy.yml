name: Deploy to Production

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: self-hosted
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Build and Deploy
        run: |
          cd /root/study-material-service
          
          # Pull latest code
          git pull origin main
          
          # Write .env file
          cat > .env << 'EOF'
          ${{ secrets.DOCKER_COMPOSE_ENV }}
          EOF
          
          # Build and restart containers
          docker compose build
          docker compose up -d
          
          # Show status
          docker compose ps